# Vibe — 多智能体产品迭代框架

基于 Cursor IDE 的多智能体协作框架，通过角色分工自动驱动产品迭代流程（规划 → 设计 → 开发 → 测试 → 验收），在关键决策点保留人类审批。

## 架构概览

```
                    ┌─────────────────┐
                    │     人类决策     │
                    └────────▲────────┘
                             │
              ┌──────────────┴──────────────┐
              │                             │
     ┌────────▼────────┐          ┌────────▼────────┐
     │   Supervisor    │          │  supervisor.sh  │
     │  (Skill 调度)   │          │   (脚本调度)     │
     └────────┬────────┘          └────────┬────────┘
              │                             │
    ┌─────────┴─────────────────────────────┴─────────┐
    │               核心执行 Agent 层                   │
    ├─────────────────────────────────────────────────-┤
    │  产品线          │  技术线          │  测试线      │
    │  ┌────────────┐  │  ┌────────────┐  │ ┌────────┐ │
    │  │ 产品经理   │  │  │ 技术骨干   │  │ │测试专员│ │
    │  └────────────┘  │  └──────┬─────┘  │ └────────┘ │
    │                  │         ▼        │            │
    │                  │  ┌────────────┐  │            │
    │                  │  │ 开发专员   │  │            │
    │                  │  └────────────┘  │            │
    ├──────────────────────────────────────────────────┤
    │          按需调用（完整模式 / 升级时）             │
    │  ┌──────────┐  ┌──────────┐  ┌──────────┐       │
    │  │ 产品总监 │  │ 技术总监 │  │ 测试总监 │       │
    │  └──────────┘  └──────────┘  └──────────┘       │
    └──────────────────────────────────────────────────┘
```

## 核心特性

- **角色分工** — 7 个专业 Agent（产品总监、产品经理、技术总监、技术骨干、开发专员、测试总监、测试专员），职责明确、边界清晰
- **多种迭代模式** — 完整 / 快速 / 修复 / 探索，按需求规模选择最优流程
- **文档驱动协作** — 所有角色通过 `.vibe/docs/` 下的文档进行协作，全程可追溯
- **人类在环** — 关键节点（PRD 审批、架构决策、发布评估）自动暂停，等待人类决策
- **质量铁律** — 证据优先、根因优先、3 次失败升级、禁止 Workaround
- **自动调度** — Supervisor 根据 Agent 返回的结构化 JSON 自动推进流程

## 迭代模式

| 模式 | 适用场景 | 流程 |
|------|----------|------|
| **完整模式** | 新功能、大重构 | 规划 → 设计 → 开发 → 测试 → 验收 |
| **快速模式** | 小需求、UI 调整 | 设计 → 开发 → 测试 |
| **修复模式** | Bug 修复 | 分析 → 修复 → 验证 |
| **探索模式** | 技术调研 | 调研 → 验证 → 总结 |

## 项目结构

```
vibe/
├── agents/                     # Agent 定义（YAML frontmatter + 角色提示词）
│   ├── 产品总监.md
│   ├── 产品经理.md
│   ├── 技术总监.md
│   ├── 技术骨干.md
│   ├── 开发专员.md
│   ├── 测试总监.md
│   └── 测试专员.md
│
├── skills/                     # Skill 定义（可复用能力模块）
│   ├── supervisor/             # 主调度逻辑
│   ├── supervisor-fix/         # 测试-修复循环
│   ├── developer/              # 开发工作流
│   ├── tester/                 # 测试工作流
│   ├── product-manager/        # 产品管理
│   ├── product-director/       # 产品战略
│   ├── tech-director/          # 架构决策
│   ├── tech-lead/              # 技术分析
│   ├── test-director/          # 测试策略
│   ├── command-executor/       # 命令执行防阻塞
│   ├── shared/                 # 共享原则
│   └── templates/              # 文档模板
│
├── .vibe/docs/                 # 运行时文档工作区
│   ├── 迭代计划.md             # 当前迭代状态
│   ├── 进度总览.md             # 任务看板
│   ├── 决策记录.md             # 人类决策历史
│   ├── 问题跟踪.md             # Bug 全生命周期
│   ├── prd/                    # PRD 文档
│   ├── design/                 # 设计文档
│   ├── testcase/               # 测试用例
│   └── reviews/                # 代码审查
│
├── QUICK_REFERENCE.md          # 快速参考
└── README_SUPERVISOR.md        # 调度脚本说明
```

## 快速开始

### 前置要求

- [Cursor IDE](https://cursor.com) 已安装
- Cursor CLI 已配置（用于脚本调度模式）

```bash
curl https://cursor.com/install -fsS | bash
export CURSOR_API_KEY=your_api_key_here
```

### 使用方式

**方式一：IDE 内 Skill 调度**

1. 在 `.vibe/docs/迭代计划.md` 中写明迭代目标和任务
2. 在 Cursor 中调用 Supervisor Skill 启动调度
3. Supervisor 自动按流程调用各角色 Agent 执行任务
4. 在人类决策点进行审批或调整

**方式二：脚本调度**

```bash
# 启动调度（默认最大 100 轮）
./supervisor.sh

# 指定最大轮次
./supervisor.sh 50
```

脚本通过 Cursor Headless CLI 以非交互模式调用 Agent，自动解析返回的 JSON 并继续调度。详见 `README_SUPERVISOR.md`。

## 角色说明

| 角色 | 职责 | 调用时机 |
|------|------|----------|
| **Supervisor** | 调度 Agent、推进流程 | 始终 |
| **产品经理** | 编写 PRD、产品验收 | 设计 / 验收阶段 |
| **技术骨干** | 详细设计、疑难排查、代码审查 | 设计 / 开发 / 修复阶段 |
| **开发专员** | 编码实现、单元测试、Bug 修复 | 开发 / 修复阶段 |
| **测试专员** | 测试用例、执行测试、提交 Bug | 测试 / 修复阶段 |
| **产品总监** | 产品规划、审批 PRD | 仅完整模式规划阶段 |
| **技术总监** | 架构设计、技术选型 | 仅完整模式 + 架构升级 |
| **测试总监** | 测试策略、发布质量评估 | 仅完整模式测试阶段 |

## 核心原则

1. **证据优先于声明** — 任何完成声明必须有新鲜的验证证据，禁止"已完成""应该没问题"
2. **根因优先于修复** — 未找到根因前不得提出修复方案，禁止猜测修复
3. **3 次失败质疑架构** — 同一问题修复 3 次仍失败 → 立即停止 → 升级上报
4. **禁止 Workaround** — 不创建空文件、不注释测试、不硬编码绕过

### 升级路径

```
开发专员 → 技术骨干 → 技术总监 → 人类
测试专员 → 测试总监 → 人类
产品经理 → 产品总监 → 人类
```

## 定制

- **添加角色**：在 `agents/` 下新建 `.md` 文件，配置 YAML frontmatter（name / model / tools / agentMode）
- **添加 Skill**：在 `skills/` 下新建目录，编写 `SKILL.md` 定义工作流
- **调整流程**：修改 `skills/supervisor/SKILL.md` 中的阶段定义和调度逻辑

## License

MIT
